<div id="main" style="height:500px; width:500px;  position: absolute; margin: auto; top: 0;right: 0; left: 0; bottom: 0;border: 2px solid;">

    <div id="form-wrapper">

        <div id="signDiv">
            username: <input id="signDiv-username" type="text"><br>
            password: <input id="signDiv-password" type+"password">
            <button id="signDiv-signIn">Sign in</button>
            <button id="signDiv-signUp">Sign up</button> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
            <button id="skipSign">Play Offline</button>
        </div>
    </div>
    <div id="menuDiv" style="display:none;overflow:hidden;">
        <button id="playStoryMode">Story Mode</button>
        <button id="loadLevelsList">User Created Levels</button>
        <button id="changeSettings">Settings</button>
    </div>
    <div id="levelsList"></div>

    <div id="gameDiv" style="display:none;overflow:hidden; " />


</div>
    <link rel="stylesheet" type="text/css" href="resources/login-middle.css">
    <script src="http://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script type="text/javascript" src="js/config.js"></script>
    <script type="text/javascript" src="js/entities.js"></script>
    <script type="text/javascript" src="js/gun.js"></script>
    <script type="text/javascript" src="js/level.js"></script>
    <script type="text/javascript" src="js/sprite.js"></script>








    <script>

        //codes for login

        var socket = io();

        //login menu
        var signDiv = document.getElementById('signDiv');
        var signDivUsername = document.getElementById('signDiv-username');
        var signDivSignIn = document.getElementById('signDiv-signIn');
        var signDivSignUp = document.getElementById('signDiv-signUp');
        var signDivPassword = document.getElementById('signDiv-password');

        //main menu after sign-in
        var menuDiv = document.getElementById('menuDiv');
        var storyMode = document.getElementById('playStoryMode');
        var loadLevelsList = document.getElementById('loadLevelsList');
        var settings = document.getElementById('changeSettings');

        var offLinePlay = document.getElementById("skipSign");

        signDivSignIn.onclick = function () {
            socket.emit('signIn', { username: signDivUsername.value, password: signDivPassword.value });
        }
        signDivSignUp.onclick = function () {
            socket.emit('signUp', { username: signDivUsername.value, password: signDivPassword.value });
        }
        socket.on('signInResponse', function (data) {
            if (data.success) {
                loadMenu();
            } else
                alert("Sign in unsuccessul.");
        });
        socket.on('signUpResponse', function (data) {
            if (data.success) {
                alert("Sign up successul.");
            } else
                alert("Sign up unsuccessul.");
        });
        offLinePlay.onclick = function () {
            loadGame(false);
        }

        loadLevelsList.onclick = function () {
            loadLevelsListFunct();
        }



        //game

        var canvas;
        var container = document.getElementById("gameDiv");


        function create(type, id, left, top, width, height) {
            var elem = document.createElement(type);
            elem.id = id;
            if (left != 0) { elem.style.left = left; }
            if (top != 0) { elem.style.top = top; }
            if (height != 0) {
                elem.height = height;
            }
            if (width != 0) {
                elem.width = width;
            }
            if (id != "bg") {
                container.appendChild(elem);
            }
            return elem;
        }

        var neededFiles = ["tiles.json", "entities.json", "config.json", "weapons.json"];



        var loaded = false;
        function loadJSONFile(callback, file) {
            socket.emit('loadJSON', {
                fileName: file
            });

            socket.on(file, function (data) {
                callback(data.toString());
            });

        }
        var conf;

        //This loads things from the database
        var loadDB = function (type, callback) {
            socket.emit('loadDB', {
                collectionName: type
            });

            socket.on(collectionName, function (data) {
                callback(data.toString());
            });
        }

        var loadLevelsListFunct = function () {
            menuDiv.style.display = 'none';
            /*
            loadDB('levelsList', function (data) {
                console.log(data);
            });*/
            var levelsList = document.getElementById('levelsList');
            var levelRow = document.createElement("P");
            var t = document.createTextNode("Desert      Brandon     March 1st, 2018");
            levelRow.appendChild(t);
            levelsList.appendChild(levelRow);
        }

  


        var map;

        function getMap(newMap) {
            map = newMap;
        };

        var loadMenu = function () {
            signDiv.style.display = 'none';
            gameDiv.style.display = '';
           menuDiv.style.display = 'block';
        }


        function loadNeeded() {
            for (var x of neededFiles) {
                var resource = "/client/resources/";
                if (x == "config.json") {
                    resource = "/client/js/";
                    conf =
                        loadJSONFile(function (response) {
                            conf = CONFIG(response);
                        }, resource + x);
                } else if (x == "weapons.json") {
                    loadJSONFile(function (response) {
                        loadWeapons(response);
                    }, resource + x);
                }
                else {
                    loadJSONFile(function (response) {
                        loadSprites(response, canvas);
                    }, resource + x);
                }
            }
        }


        function loadGame(reload) {
            //setting the divs correctly
            signDiv.style.display = 'none';
            gameDiv.style.display = '';
            if (!reload) {
                loadNeeded();
            }
            //loading the needed files


            //loading the test map
            loadMap("map1", function (m) {

                loadJSONFile(function (response) {
                    m.loadCharacter(response);
                }
                    , "/client/resources/stud.json");
            });
        }



        var interval = setInterval(update, 1000 / 60);

        function update() {
            if (loaded) {
                canvas.getContext("2d").clearRect(0, 0, canvas.width, canvas.height);
                map.drawMap();
                map.doTick();
            }
        }


        document.onkeydown = function (e) {
            e = e || window.event;
            var charCode = (typeof e.which == "number") ? e.which : e.keyCode;
            if (charCode && loaded) {
                map.getPlayer().doMove(conf[charCode], true);
            }
        };

        document.onkeyup = function (e) {
            e = e || window.event
            var charCode = (typeof e.which == "number") ? e.which : e.keyCode;
            if (charCode && loaded) {
                map.getPlayer().doMove(conf[charCode], false);
            }
        };


        //only needed for some debugging ..
        document.onmousedown = function (e) {
            e = e || window.event;
            if (loaded) {
                var poss = getMousePos(canvas, e);
                console.log(poss.x + " " + poss.y);
            }
        }

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }


       //window.onload = loadGame();

    </script>
    <body>

    </body>
